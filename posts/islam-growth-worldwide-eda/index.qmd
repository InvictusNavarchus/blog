---
title: EDA on islam religion growth worldwide
description: Exploring World Religion dataset to uncover the growth of Islam in various countries using R
date: 2024-08-14:06:08:00
categories: [EDA, R]
image: mosque.png
toc-expand: true
---

## Setup

```{r}
library(tidyverse)
library(visdat)
library(DataExplorer)
library(naniar)
library(janitor)
library(validate)
library(countrycode)
library(stringdist)
```

```{r}
df <- read_csv('./ThrowbackDataThursday 201912 - Religion.csv')
```

## Inspect Dataset

```{r}
df
```

```{r}
df |> str()
```

## Clean Data

### Pick relevant columns

```{r}
df_islam <- df |> 
  select(Country = StateNme, Year, starts_with('Islam'))

df_islam
```

### Check Data type

```{r}
df_islam |> 
  str()
```

#### Fix Data Types

```{r}
df_islam_correct_type <- df_islam |> 
  mutate(Country = as_factor(Country))
```

### Check Duplicate

```{r}
df_islam_correct_type |> names()
```

#### Check duplicate Year

```{r}
df_islam_correct_type |> 
  get_dupes() |> 
  relocate(dupe_count)
```

```{r}
df_islam_correct_type |>
  count(Year, Country) |> 
  arrange(desc(n)) |> 
  count(n)
```

#### Remove duplicate using distinct()

```{r}
df_islam |> 
  nrow()
```

```{r}
df_islam_correct_type |> 
  distinct() |> 
  nrow()
```

```{r}
df_islam_removedduplicate <- df_islam_correct_type |> 
  distinct()
```

### Check Missing Value

```{r}
df_islam_removedduplicate |> 
  vis_miss()
```

```{r}
df_islam_replacedna <- df_islam_removedduplicate |> 
  mutate(across(everything(), function(x) replace_na(x, 0)))

df_islam_replacedna |> 
  vis_miss()
```

#### Check Zero Distribution (Possible Null Value)

```{r}
df_islam_replacedna |>
  select(!Country) |> 
  vis_expect(function(x) x != 0)
```
#### Replace zero with NA

```{r}
df_islam_replacedzero <- df_islam_replacedna |> 
  mutate(across(everything(), function(x) if_else(x == 0, NA, x)))
```

### Check Missing Value (Second Stage)

```{r}
df_islam_replacedzero |> 
  miss_var_summary()
```


```{r}
df_islam_replacedzero |> 
  gg_miss_var()
```

```{r}
df_islam_replacedzero
```


```{r}
df_islam_replacedzero |> 
  gg_miss_upset()
```

### Check Data Constrains

#### Check Country Names

##### Exact Check

```{r}
valid_countries <- codelist$country.name.en
df_country_only <- df_islam |> 
  distinct(Country)

validation_rules_country <- validator(
  Country %in% valid_countries
)

cf_country <- confront(df_country_only, validation_rules_country)
```

```{r}
summary(cf_country)
```
```{r}
invalid_country <- violating(df_country_only, cf_country) |> 
  arrange(Country) |> 
  pull(Country)

invalid_country
```


##### Similarity Check

```{r}
# Function to find the most similar country
find_closest_country <- function(country, valid_list) {
  distances <- stringdist(country, valid_list, method = 'jw')
  closest <- valid_list[which.min(distances)]
  return(closest)
}
# Apply the function to each country in the small vector
results <- sapply(invalid_country, find_closest_country, valid_countries)

# Create a data frame to display results
comparison <- tibble(
  Original = invalid_country,
  Closest_Match = results
)

comparison
```

#### Check Integers

```{r}
validation_rules_integer <- validator(
  `Islam - Sunni (Population)` %% 1 == 0,
  `Islam - Shi'a (Population)` %% 1 == 0,
  `Islam - Ibadhi (Population)` %% 1 == 0,
  `Islam - Nation of Islam (Population)` %% 1 == 0,
  `Islam - Alawite (Population)` %% 1 == 0,
  `Islam - Ahmadiyya (Population)` %% 1 == 0,
  `Islam - Others (Population)` %% 1 == 0,
  `Islam - Total (Population)` %% 1 == 0
)
cf_integer <- confront(df_islam_replacedzero, validation_rules_integer)
summary(cf_integer)
```
#### Check Decimals

```{r}
validation_rules_decimal <- validator(
  `Islam - Sunni (Percent)` %% 1 > 0,
  `Islam - Shi'a (Percent)` %% 1 > 0,
  `Islam - Ibadhi (Percent)` %% 1 > 0,
  `Islam - Nation of Islam (Percent)` %% 1 > 0,
  `Islam - Alawite (Percent)` %% 1 > 0,
  `Islam - Ahmadiyya (Percent)` %% 1 > 0,
  `Islam - Others (Percent)` %% 1 > 0,
  `Islam - Total (Percent)` %% 1 > 0
)

cf_decimal <- confront(df_islam_replacedzero,validation_rules_decimal)
summary(cf_decimal)
```
```{r}
violating(df_islam_replacedzero |> 
            select(Country, Year, contains('Percent')),
          cf_decimal)
```


### Check Distribution

#### Overview

```{r}
df_islam_replacedzero |> 
  select(contains('Population')) |> 
  plot_histogram(ncol = 1)
```

#### Year

```{r}
df_islam_replacedzero |> 
  ggplot(aes(Year)) +
  geom_line(stat = 'count') + 
  geom_point(stat='count') +
  scale_x_continuous(breaks = seq(1945, 2010, by=5))
```


#### Country

```{r}
df_islam_replacedzero |> 
  distinct(Country) |> 
  nrow()
```
#### Country Per Year

```{r}
df_islam_year_data <- df_islam_replacedzero |> 
  count(Country) |> 
  count(n) |> 
  arrange(desc(nn)) |> 
  rename('Year Data Availibility' = n, 'Total Country' = nn)

df_islam_year_data |> 
  ggplot(aes(`Year Data Availibility`, `Total Country`)) +
  geom_col() +
  scale_x_continuous(breaks = seq(1:14))
```

```{r}
validation_rules_year <- validator(
  contains_at_least( 
      keys = data.frame(Year = seq(1945, 2010, by=5)),
      by=list(Country) )
)

cf_year <- confront(df_islam_replacedzero, validation_rules_year)
summary(cf_year)
```

```{r}
incomplete_country <- violating(df_islam_replacedzero, cf_year) |> 
  select(Country, Year)
```

##### Check Year Gap

```{r}
incomplete_country |>
  group_by(Country) |> 
  mutate(lagged_Year = lag(Year, default = first(Year))) |> 
  mutate(Year_Gap = Year -lagged_Year) |> 
  ggplot(aes(Year_Gap)) +
  geom_bar() +
  scale_x_continuous(breaks = seq(0,100, by=5))
```
##### Average Starting Year

```{r}
df_islam_replacedzero |> 
  select(Country, Year) |> 
  group_by(Country) |> 
  slice(1) |> 
  ggplot(aes(Year)) +
  geom_bar() +
  scale_x_continuous(breaks = seq(1945, 2010, by=5))
```
##### Average Final Year

```{r}
df_islam_final_year_count <- df_islam_replacedzero |> 
  select(Country, Year) |> 
  group_by(Country) |> 
  slice_tail() |> 
  ungroup() |> 
  count(Year)

df_islam_final_year_count
```
```{r}
df_islam_final_year_count |> 
  ggplot(aes(Year, n)) +
  geom_col()
```

